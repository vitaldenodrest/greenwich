%%(encoding:utf-8)
%% author: Frédéric Boulanger, frederic.boulanger@centralesupelec.fr
%% author: Vital de Nodrest
%% copyright CentraleSupélec 2025
%% v1.1.gre: greenwich
%% v1.0: initial release
\ProvidesPackage{beamerouterthemecs}[2025/10/01 v1.1.gre Beamer theme for CentraleSupelec x University of Greenwich collaboration] %%FLAG

\mode <all>

\mode<presentation>


% Defining TikZ colors using the Beamer palette (beamercolortheme)
\usebeamercolor{palette primary}
\colorlet{primary}{palette primary.fg}
\usebeamercolor{palette secondary}
\colorlet{secondary}{palette secondary.fg}
\usebeamercolor{palette tertiary}
\colorlet{tertiary}{palette tertiary.bg}


%\AtBeginDocument{
%  {
%    \usebeamerfont*{headline}
%
%    \usebeamercolor{normal text}
%    \usebeamercolor{title in head/foot}
%    \usebeamercolor{subsection in head/foot}
%    \usebeamercolor{section in head/foot}
%    \usebeamercolor{frametitle}
%
%    \pgfdeclareverticalshading{beamer@treeshade}{\the\paperwidth}{%
%      color(0ex)=(normal text.bg);%
%      color(1ex)=(subsection in head/foot.bg);%
%      color(3.25ex)=(subsection in head/foot.bg);%
%      color(4.25ex)=(section in head/foot.bg);%
%      color(6.5ex)=(section in head/foot.bg);%
%      color(7.5ex)=(title in head/foot.bg);%
%      color(10.25ex)=(title in head/foot.bg)%
%    }
%    
%    \pgfdeclareverticalshading{beamer@aboveframetitle}{\the\paperwidth}{%
%      color(0ex)=(frametitle.bg);%
%      color(1ex)=(frametitle.bg);%
%      color(2ex)=(subsection in head/foot.bg)
%    }
%
%    \pgfdeclareverticalshading{beamer@belowframetitle}{\the\paperwidth}{%
%      color(0ex)=(normal text.bg);%
%      color(1ex)=(frametitle.bg)
%    }
%  }
%}
  
\defbeamertemplate*{footline}{infolines theme} {%
  \leavevmode\hbox{%
  \csname tikzexternaldisable\endcsname
  \begin{tikzpicture}[x=1mm,y=1mm]
    % Background
    \path[fill=cs-logoblue!50] (0,0) -- ++(0,4) 
      -- ++(\linewidth+\beamer@rightmargin+\beamer@leftmargin,0) 
      -- ++(0,-4) -- cycle ;
    % Presentation title
    \node[align=left] at (0.02\paperwidth,1.5) {\raisebox{0pt}[0pt][0pt]{\makebox[0pt][l]{%
      \usebeamercolor[fg]{title in head/foot}\usebeamerfont{title in head/foot}\beamer@shorttitle
    }}} ;
    % Section and subsection
    \node[align=center] at (0.5\paperwidth,1.5) {\raisebox{0pt}[0pt][0pt]{\makebox[0pt]{%
      \usebeamercolor[fg]{section in head/foot}\usebeamerfont{section in head/foot}\insertsectionhead \hspace{1em} \textbf{\insertsubsectionhead}
    }}} ;
    % Date and frame number
    \node[align=right] at (0.96\paperwidth,1.5) {\raisebox{0pt}[0pt][0pt]{\makebox[0pt][r]{%
      \usebeamercolor[fg]{date in head/foot}\usebeamerfont{date in head/foot}%
      \insertshortdate{}\hspace{2em}\insertframenumber{} / \inserttotalframenumber
    }}} ;
  \end{tikzpicture}%
  }%
}


\defbeamertemplate*{headline}{cs} {%
  \usebeamerfont{headline}%
  {\csname tikzexternaldisable\endcsname
  \begin{tikzpicture}[x=1mm,y=1mm]

    % Thin shade CS -> Greenwich
    \path[shade,
          left color=primary,
          right color=secondary] 
      (0,0)
      rectangle
      (\paperwidth,-1);

  \end{tikzpicture}%
  }%
}


\usetikzlibrary{calc}
\defbeamertemplate*{frametitle}{cs}{%
  \nointerlineskip
  \vspace*{1 mm} % Gap between the headline and the title
  \hspace*{-\beamer@leftmargin} % Compensate for the margin
  {\csname tikzexternaldisable\endcsname
  \noindent\begin{tikzpicture}[x=1mm,y=1mm]

    % Logo gauche
    \node[anchor=west, inner sep=0pt] (logocsnode) at (2,-7)
      {\pgfuseimage{logocs}};

    % Logo droit
    \node[anchor=east, inner sep=0pt] (logogrenode) at (\paperwidth-2,-7)
      {\pgfuseimage{logogre}};

    % Position centrale entre les deux logos
    \path let \p1 = (logocsnode.east), \p2 = (logogrenode.west) in
      node[align=center, text width={veclen(\x2-\x1,\y2-\y1)}, anchor=center]
        at ($ (logocsnode.east)!0.5!(logogrenode.west) $) {%
          {\usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}\insertframetitle}%
          \ifx\insertframesubtitle\@empty
          \else
            \\[-0.3ex]{\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertframesubtitle}%
          \fi
        };

  \end{tikzpicture}%
  }%
  \hspace*{-\beamer@rightmargin}%
}


% Disable navigation symbols
\setbeamertemplate{navigation symbols}{}


\setbeamerfont{block title}{size={}}
\setbeamerfont{institute}{size=\footnotesize}
\setbeamersize{text margin left=1em,text margin right=1em}
  
\mode
<all>

\endinput
